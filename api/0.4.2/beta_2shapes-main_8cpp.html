<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>icedb: apps/3d_structures_beta/shapes-main.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">icedb
   &#160;<span id="projectnumber">version 0.4.2</span>
   </div>
   <div id="projectbrief">Snow particle scattering database API</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_9654b8d08f4bba4e84b362c5fd320bee.html">apps</a></li><li class="navelem"><a class="el" href="dir_3b1138b848d8920f9ee38d0661f594d2.html">3d_structures_beta</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">shapes-main.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="defs_8h_source.html">icedb/defs.h</a>&gt;</code><br />
<code>#include &lt;boost/program_options.hpp&gt;</code><br />
<code>#include &lt;atomic&gt;</code><br />
<code>#include &lt;chrono&gt;</code><br />
<code>#include &lt;deque&gt;</code><br />
<code>#include &lt;future&gt;</code><br />
<code>#include &lt;iostream&gt;</code><br />
<code>#include &lt;memory&gt;</code><br />
<code>#include &lt;mutex&gt;</code><br />
<code>#include &lt;set&gt;</code><br />
<code>#include &lt;stack&gt;</code><br />
<code>#include &lt;string&gt;</code><br />
<code>#include &lt;vector&gt;</code><br />
<code>#include &lt;<a class="el" href="lib_2icedb_2shape_8hpp_source.html">icedb/shape.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="Database_8hpp_source.html">icedb/Database.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="fs__backend_8hpp_source.html">icedb/fs_backend.hpp</a>&gt;</code><br />
<code>#include &quot;<a class="el" href="hdf5__supplemental_8hpp_source.html">../../lib/private/hdf5_supplemental.hpp</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="apps_23d__structures__beta_2shape_8hpp_source.html">shape.hpp</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="beta_2shapeIOtext_8hpp_source.html">shapeIOtext.hpp</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for shapes-main.cpp:</div>
<div class="dyncontent">
<div class="center"><img src="beta_2shapes-main_8cpp__incl.png" border="0" usemap="#apps_23d__structures__beta_2shapes-main_8cpp" alt=""/></div>
<map name="apps_23d__structures__beta_2shapes-main_8cpp" id="apps_23d__structures__beta_2shapes-main_8cpp">
<area shape="rect" id="node2" href="defs_8h.html" title="icedb/defs.h" alt="" coords="173,632,267,659"/>
<area shape="rect" id="node16" href="lib_2icedb_2shape_8hpp.html" title="icedb/shape.hpp" alt="" coords="987,244,1104,271"/>
<area shape="rect" id="node33" href="Database_8hpp.html" title="icedb/Database.hpp" alt="" coords="425,244,564,271"/>
<area shape="rect" id="node35" href="fs__backend_8hpp.html" title="icedb/fs_backend.hpp" alt="" coords="1407,408,1556,435"/>
<area shape="rect" id="node37" href="hdf5__supplemental_8hpp.html" title="../../lib/private/hdf5\l_supplemental.hpp" alt="" coords="1669,319,1800,360"/>
<area shape="rect" id="node46" href="apps_23d__structures__beta_2shape_8hpp.html" title="shape.hpp" alt="" coords="1100,169,1183,196"/>
<area shape="rect" id="node47" href="beta_2shapeIOtext_8hpp.html" title="shapeIOtext.hpp" alt="" coords="1075,95,1194,121"/>
<area shape="rect" id="node17" href="fs_8hpp.html" title="fs.hpp" alt="" coords="1237,408,1296,435"/>
<area shape="rect" id="node23" href="Table_8hpp.html" title="Table.hpp" alt="" coords="721,408,799,435"/>
<area shape="rect" id="node24" href="Attribute_8hpp.html" title="Attribute.hpp" alt="" coords="872,483,968,509"/>
<area shape="rect" id="node28" href="Group_8hpp.html" title="Group.hpp" alt="" coords="719,326,801,353"/>
<area shape="rect" id="node19" href="Data__Types_8hpp.html" title="Data_Types.hpp" alt="" coords="971,557,1090,584"/>
<area shape="rect" id="node29" href="util_8hpp.html" title="util.hpp" alt="" coords="419,408,483,435"/>
<area shape="rect" id="node42" href="hdf5__load_8h.html" title="hdf5_load.h" alt="" coords="2351,408,2441,435"/>
</map>
</div>
</div>
<p><a href="beta_2shapes-main_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ae40c007b788d66f509cf4110d9c98e2a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="beta_2shapes-main_8cpp.html#ae40c007b788d66f509cf4110d9c98e2a">readtask</a> ()</td></tr>
<tr class="memdesc:ae40c007b788d66f509cf4110d9c98e2a"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is the primary function in each thread devoted to reading shapes. Usually, about three of these threads are active.  <a href="#ae40c007b788d66f509cf4110d9c98e2a">More...</a><br /></td></tr>
<tr class="separator:ae40c007b788d66f509cf4110d9c98e2a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6285f7490b6dd81ce98e2527e0620413"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="beta_2shapes-main_8cpp.html#a6285f7490b6dd81ce98e2527e0620413">construct_thread_pool</a> (int numThreads)</td></tr>
<tr class="memdesc:a6285f7490b6dd81ce98e2527e0620413"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convenience function to build a pool of threads for parsing shapes and writing to the hdf5 file.  <a href="#a6285f7490b6dd81ce98e2527e0620413">More...</a><br /></td></tr>
<tr class="separator:a6285f7490b6dd81ce98e2527e0620413"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="beta_2shapes-main_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (int argc, char **argv)</td></tr>
<tr class="memdesc:a3c04138a5bfe5d72780bb7e82a18e627"><td class="mdescLeft">&#160;</td><td class="mdescRight">The main body of the program.  <a href="#a3c04138a5bfe5d72780bb7e82a18e627">More...</a><br /></td></tr>
<tr class="separator:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a960132aac36b2821e18a312a2b820b97"><td class="memItemLeft" align="right" valign="top">std::vector&lt; std::unique_ptr&lt; std::thread &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="beta_2shapes-main_8cpp.html#a960132aac36b2821e18a312a2b820b97">pool</a></td></tr>
<tr class="memdesc:a960132aac36b2821e18a312a2b820b97"><td class="mdescLeft">&#160;</td><td class="mdescRight">3d_structures program - An example program to read and write shape files  <a href="#a960132aac36b2821e18a312a2b820b97">More...</a><br /></td></tr>
<tr class="separator:a960132aac36b2821e18a312a2b820b97"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e46e701431fdc40f70f68212577e809"><td class="memItemLeft" align="right" valign="top">std::atomic&lt; int &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="beta_2shapes-main_8cpp.html#a6e46e701431fdc40f70f68212577e809">countCurrentReading</a></td></tr>
<tr class="separator:a6e46e701431fdc40f70f68212577e809"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afffb20412201640ed4485ef8f3e87777"><td class="memItemLeft" align="right" valign="top">std::mutex&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="beta_2shapes-main_8cpp.html#afffb20412201640ed4485ef8f3e87777">mStack</a></td></tr>
<tr class="separator:afffb20412201640ed4485ef8f3e87777"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad770ae469f46c5e465bcf7d48d8fc461"><td class="memItemLeft" align="right" valign="top">std::mutex&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="beta_2shapes-main_8cpp.html#ad770ae469f46c5e465bcf7d48d8fc461">mOutStack</a></td></tr>
<tr class="separator:ad770ae469f46c5e465bcf7d48d8fc461"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f75b75f2d0e71cf4186e65873f6fe55"><td class="memItemLeft" align="right" valign="top">std::deque&lt; std::pair&lt; sfs::path, std::string &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="beta_2shapes-main_8cpp.html#a6f75b75f2d0e71cf4186e65873f6fe55">myreadstack</a></td></tr>
<tr class="separator:a6f75b75f2d0e71cf4186e65873f6fe55"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac6ebd12a47facab27a62eb12318407e5"><td class="memItemLeft" align="right" valign="top">std::deque&lt; std::tuple&lt; <a class="el" href="structicedb_1_1Examples_1_1Shapes_1_1ShapeDataBasic.html">icedb::Examples::Shapes::ShapeDataBasic</a>, sfs::path, std::string &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="beta_2shapes-main_8cpp.html#ac6ebd12a47facab27a62eb12318407e5">mywritestack</a></td></tr>
<tr class="separator:ac6ebd12a47facab27a62eb12318407e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ff39e8837d08d3882dff11186175cb5"><td class="memItemLeft" align="right" valign="top">const std::map&lt; std::string, std::set&lt; sfs::path &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="beta_2shapes-main_8cpp.html#a6ff39e8837d08d3882dff11186175cb5">file_formats</a></td></tr>
<tr class="separator:a6ff39e8837d08d3882dff11186175cb5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a33d07d20f02fedf81b5233e8669dc795"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="beta_2shapes-main_8cpp.html#a33d07d20f02fedf81b5233e8669dc795">resolution_um</a> = 0</td></tr>
<tr class="memdesc:a33d07d20f02fedf81b5233e8669dc795"><td class="mdescLeft">&#160;</td><td class="mdescRight">The resolution of each shape lattice, in micrometers.  <a href="#a33d07d20f02fedf81b5233e8669dc795">More...</a><br /></td></tr>
<tr class="separator:a33d07d20f02fedf81b5233e8669dc795"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af2462107fd88e4fae695c56c89d224dc"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="beta_2shapes-main_8cpp.html#af2462107fd88e4fae695c56c89d224dc">nccompat</a> = true</td></tr>
<tr class="memdesc:af2462107fd88e4fae695c56c89d224dc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Are we forcing NetCDF-4 compatability.  <a href="#af2462107fd88e4fae695c56c89d224dc">More...</a><br /></td></tr>
<tr class="separator:af2462107fd88e4fae695c56c89d224dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a008512d236c3702c3fa30e760d958acd"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classicedb_1_1Groups_1_1Group.html#a8fab827d9a758f3ee76502f02901b9c2">icedb::Groups::Group::Group_ptr</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="beta_2shapes-main_8cpp.html#a008512d236c3702c3fa30e760d958acd">basegrp</a></td></tr>
<tr class="memdesc:a008512d236c3702c3fa30e760d958acd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Shapes get written to this location in the output database.  <a href="#a008512d236c3702c3fa30e760d958acd">More...</a><br /></td></tr>
<tr class="separator:a008512d236c3702c3fa30e760d958acd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a6285f7490b6dd81ce98e2527e0620413"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6285f7490b6dd81ce98e2527e0620413">&#9670;&nbsp;</a></span>construct_thread_pool()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool construct_thread_pool </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>numThreads</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convenience function to build a pool of threads for parsing shapes and writing to the hdf5 file. </p>

<p class="definition">Definition at line <a class="el" href="beta_2shapes-main_8cpp_source.html#l00132">132</a> of file <a class="el" href="beta_2shapes-main_8cpp_source.html">shapes-main.cpp</a>.</p>

<p class="reference">References <a class="el" href="beta_2shapes-main_8cpp_source.html#l00090">readtask()</a>.</p>

<p class="reference">Referenced by <a class="el" href="beta_2shapes-main_8cpp_source.html#l00149">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                                           {</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordflow">if</span> (numThreads &gt; 1) numThreads-= 1;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; numThreads; ++i)</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        <a class="code" href="beta_2shapes-main_8cpp.html#a960132aac36b2821e18a312a2b820b97">pool</a>.push_back(std::make_unique&lt;std::thread&gt;(<a class="code" href="beta_2shapes-main_8cpp.html#ae40c007b788d66f509cf4110d9c98e2a">readtask</a>));</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="comment">//pool.resize(numThreads, std::thread(task));</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;}</div><div class="ttc" id="beta_2shapes-main_8cpp_html_ae40c007b788d66f509cf4110d9c98e2a"><div class="ttname"><a href="beta_2shapes-main_8cpp.html#ae40c007b788d66f509cf4110d9c98e2a">readtask</a></div><div class="ttdeci">void readtask()</div><div class="ttdoc">This is the primary function in each thread devoted to reading shapes. Usually, about three of these ...</div><div class="ttdef"><b>Definition:</b> <a href="beta_2shapes-main_8cpp_source.html#l00090">shapes-main.cpp:90</a></div></div>
<div class="ttc" id="beta_2shapes-main_8cpp_html_a960132aac36b2821e18a312a2b820b97"><div class="ttname"><a href="beta_2shapes-main_8cpp.html#a960132aac36b2821e18a312a2b820b97">pool</a></div><div class="ttdeci">std::vector&lt; std::unique_ptr&lt; std::thread &gt; &gt; pool</div><div class="ttdoc">3d_structures program - An example program to read and write shape files </div><div class="ttdef"><b>Definition:</b> <a href="beta_2shapes-main_8cpp_source.html#l00054">shapes-main.cpp:54</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="beta_2shapes-main_8cpp_a6285f7490b6dd81ce98e2527e0620413_cgraph.png" border="0" usemap="#beta_2shapes-main_8cpp_a6285f7490b6dd81ce98e2527e0620413_cgraph" alt=""/></div>
<map name="beta_2shapes-main_8cpp_a6285f7490b6dd81ce98e2527e0620413_cgraph" id="beta_2shapes-main_8cpp_a6285f7490b6dd81ce98e2527e0620413_cgraph">
<area shape="rect" id="node2" href="beta_2shapes-main_8cpp.html#ae40c007b788d66f509cf4110d9c98e2a" title="This is the primary function in each thread devoted to reading shapes. Usually, about three of these ..." alt="" coords="204,105,276,131"/>
<area shape="rect" id="node3" href="namespaceicedb_1_1Examples_1_1Shapes.html#a7bc9f6fc2a9e7cab2a01c3ef5af40106" title="icedb::Examples::Shapes\l::readTextFile" alt="" coords="324,97,495,139"/>
<area shape="rect" id="node4" href="namespaceicedb_1_1Examples_1_1Shapes.html#af4f846f5268e26fe554768d8e0844f0d" title="icedb::Examples::Shapes\l::readDDSCAT" alt="" coords="543,64,713,105"/>
<area shape="rect" id="node10" href="namespaceicedb_1_1Examples_1_1Shapes.html#ab50b849f9533e0dcccd4eb57e19310f0" title="Simple file assuming one substance, with 3&#45;column rows, each representing a single point..." alt="" coords="543,129,713,171"/>
<area shape="rect" id="node5" href="namespaceicedb_1_1Examples_1_1Shapes.html#aa83815532aea205d67b56220bc965228" title="icedb::Examples::Shapes\l::readHeader" alt="" coords="761,5,932,47"/>
<area shape="rect" id="node6" href="namespaceicedb_1_1Examples_1_1Shapes.html#a8e0f657be09aae9687aa63bed84f46a1" title="icedb::Examples::Shapes\l::readTextContents" alt="" coords="761,71,932,112"/>
<area shape="rect" id="node7" href="namespaceanonymous__namespace_02shapeIOtextParsers_8cpp_03.html#a705c1ebc6b7a4f400cb8d225dfd2d26b" title="Parses space&#45;separated shapefile entries. " alt="" coords="980,85,1143,156"/>
<area shape="rect" id="node8" href="namespaceanonymous__namespace_02shapeIOtextParsers_8cpp_03.html#a9119256a03fa440b5b7102800d756198" title="Used in quickly printing shapefile. " alt="" coords="1195,41,1358,112"/>
<area shape="rect" id="node9" href="namespaceanonymous__namespace_02shapeIOtextParsers_8cpp_03.html#a3590d9b16b4a098b6ddbcec4819f4c52" title="anonymous_namespace\l\{shapeIOtextParsers\l::cpp\}::print_shapefile_pts" alt="" coords="1191,137,1363,193"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="beta_2shapes-main_8cpp_a6285f7490b6dd81ce98e2527e0620413_icgraph.png" border="0" usemap="#beta_2shapes-main_8cpp_a6285f7490b6dd81ce98e2527e0620413_icgraph" alt=""/></div>
<map name="beta_2shapes-main_8cpp_a6285f7490b6dd81ce98e2527e0620413_icgraph" id="beta_2shapes-main_8cpp_a6285f7490b6dd81ce98e2527e0620413_icgraph">
<area shape="rect" id="node2" href="beta_2shapes-main_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627" title="The main body of the program. " alt="" coords="204,5,255,32"/>
</map>
</div>

</div>
</div>
<a id="a3c04138a5bfe5d72780bb7e82a18e627"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c04138a5bfe5d72780bb7e82a18e627">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>argv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The main body of the program. </p>
<p>The main program:</p><ol type="1">
<li>Reads the user-provided input options.</li>
<li>Creates or opens the output database.</li>
<li>Gathers the list of all valid input files.</li>
<li>Spawns a pool of threads to read the input files.</li>
<li>Writes the output shape objects to the output database. </li>
</ol>

<p class="definition">Definition at line <a class="el" href="beta_2shapes-main_8cpp_source.html#l00149">149</a> of file <a class="el" href="beta_2shapes-main_8cpp_source.html">shapes-main.cpp</a>.</p>

<p class="reference">References <a class="el" href="beta_2shapes-main_8cpp_source.html#l00079">basegrp</a>, <a class="el" href="fs__backend_8cpp_source.html#l00026">icedb::fs::impl::collectDatasetFiles()</a>, <a class="el" href="beta_2shapes-main_8cpp_source.html#l00132">construct_thread_pool()</a>, <a class="el" href="beta_2shapes-main_8cpp_source.html#l00056">countCurrentReading</a>, <a class="el" href="beta_2shapes-main_8cpp_source.html#l00060">mOutStack</a>, <a class="el" href="beta_2shapes-main_8cpp_source.html#l00077">nccompat</a>, <a class="el" href="beta_2shapes-main_8cpp_source.html#l00076">resolution_um</a>, and <a class="el" href="export-hdf5_8cpp_source.html#l00017">icedb::fs::hdf5::useZLIB()</a>.</p>
<div class="fragment"><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                                {</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="keywordflow">try</span> {</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <span class="keyword">using namespace </span><a class="code" href="namespacestd.html">std</a>;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <span class="comment">// Read program options</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        </div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <span class="keyword">namespace </span>po = boost::program_options;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        po::options_description desc(<span class="stringliteral">&quot;Allowed options&quot;</span>);</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        desc.add_options()</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            (<span class="stringliteral">&quot;help,h&quot;</span>, <span class="stringliteral">&quot;produce help message&quot;</span>)</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;            (<span class="stringliteral">&quot;from&quot;</span>, po::value&lt;string&gt;(), <span class="stringliteral">&quot;The path where shapes are read from&quot;</span>)</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;            (<span class="stringliteral">&quot;to&quot;</span>, po::value&lt;string&gt;(), <span class="stringliteral">&quot;The path where shapes are written to&quot;</span>)</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;            (<span class="stringliteral">&quot;db-folder&quot;</span>, po::value&lt;string&gt;()-&gt;default_value(<span class="stringliteral">&quot;shapes&quot;</span>), <span class="stringliteral">&quot;The path within the database to write to&quot;</span>)</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            (<span class="stringliteral">&quot;create&quot;</span>, <span class="stringliteral">&quot;Create the output database if it does not exist&quot;</span>)</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            (<span class="stringliteral">&quot;resolution&quot;</span>, po::value&lt;float&gt;(), <span class="stringliteral">&quot;Lattice spacing for the shape, in um&quot;</span>)</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            (<span class="stringliteral">&quot;compression-level&quot;</span>, po::value&lt;int&gt;()-&gt;default_value(6), <span class="stringliteral">&quot;Compression level (0-9). 0 is no compression, 9 is max compression.&quot;</span>)</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            (<span class="stringliteral">&quot;nc4-compat&quot;</span>, po::value&lt;bool&gt;()-&gt;default_value(<span class="keyword">true</span>), <span class="stringliteral">&quot;Generate a NetCDF4-compatible file&quot;</span>)</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            (<span class="stringliteral">&quot;truncate&quot;</span>, <span class="stringliteral">&quot;Instead of opening existing output files in read-write mode, truncate them.&quot;</span>)</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;            ;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        po::variables_map vm;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        po::store(po::command_line_parser(argc, argv).options(desc).run(), vm);</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        po::notify(vm);</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        <span class="keyword">auto</span> doHelp = [&amp;](<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; s)-&gt;<span class="keywordtype">void</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        {</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            cout &lt;&lt; s &lt;&lt; endl;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            cout &lt;&lt; desc &lt;&lt; endl;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            exit(1);</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        };</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <span class="keywordflow">if</span> (vm.count(<span class="stringliteral">&quot;help&quot;</span>)) doHelp(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="keywordflow">if</span> (!vm.count(<span class="stringliteral">&quot;from&quot;</span>) || !vm.count(<span class="stringliteral">&quot;to&quot;</span>)) doHelp(<span class="stringliteral">&quot;Need to specify to/from locations.&quot;</span>);</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        </div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <span class="keyword">using namespace </span><a class="code" href="namespaceicedb.html">icedb</a>;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="keywordtype">int</span> clev = vm[<span class="stringliteral">&quot;compression-level&quot;</span>].as&lt;<span class="keywordtype">int</span>&gt;();</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <a class="code" href="beta_2shapes-main_8cpp.html#af2462107fd88e4fae695c56c89d224dc">nccompat</a> = vm[<span class="stringliteral">&quot;nc4-compat&quot;</span>].as&lt;<span class="keywordtype">bool</span>&gt;();</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        Expects(clev &gt;= 0);</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        Expects(clev &lt; 10);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <a class="code" href="namespaceicedb_1_1fs_1_1hdf5.html#aa823e59a8819be3d124fc64700385fe7">icedb::fs::hdf5::useZLIB</a>(clev);</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="comment">// namespace sfs defined for compatability. See &lt;icedb/fs_backend.hpp&gt;</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        <span class="keywordtype">string</span> sFromRaw = vm[<span class="stringliteral">&quot;from&quot;</span>].as&lt;<span class="keywordtype">string</span>&gt;();</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <span class="keywordtype">string</span> sToRaw = vm[<span class="stringliteral">&quot;to&quot;</span>].as&lt;<span class="keywordtype">string</span>&gt;();</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        sfs::path pFromRaw(sFromRaw);</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        sfs::path pToRaw(sToRaw);</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <span class="keywordtype">string</span> dbfolder = vm[<span class="stringliteral">&quot;db-folder&quot;</span>].as&lt;<span class="keywordtype">string</span>&gt;();</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        <span class="keywordflow">if</span> (vm.count(<span class="stringliteral">&quot;resolution&quot;</span>)) <a class="code" href="beta_2shapes-main_8cpp.html#a33d07d20f02fedf81b5233e8669dc795">resolution_um</a> = vm[<span class="stringliteral">&quot;resolution&quot;</span>].as&lt;float&gt;();</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        <span class="comment">// By default, run as many threads as we can on the platform.</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        <span class="comment">// TODO: Make this adjustable.</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> Num_Threads = thread::hardware_concurrency();</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        </div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        <span class="comment">// Create the output database if it does not exist</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        <span class="keyword">auto</span> iof = fs::IOopenFlags::READ_WRITE;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        <span class="keywordflow">if</span> (vm.count(<span class="stringliteral">&quot;create&quot;</span>)) iof = fs::IOopenFlags::CREATE;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        <span class="keywordflow">if</span> (vm.count(<span class="stringliteral">&quot;truncate&quot;</span>)) iof = fs::IOopenFlags::TRUNCATE;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="keywordflow">if</span> (!sfs::exists(pToRaw)) iof = fs::IOopenFlags::CREATE;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        <a class="code" href="classicedb_1_1Databases_1_1Database.html#a099ccc5bf7ba50a4c7425f531728e480">Databases::Database::Database_ptr</a> db = Databases::Database::openDatabase(pToRaw.string(), iof);</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        <a class="code" href="beta_2shapes-main_8cpp.html#a008512d236c3702c3fa30e760d958acd">basegrp</a> = db-&gt;createGroupStructure(dbfolder);</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <span class="comment">// Gather a list of shape files to read.</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <span class="keyword">auto</span> files = <a class="code" href="namespaceicedb_1_1fs_1_1impl.html#ae58335756c72cfc8f4f13eae099c969a">icedb::fs::impl::collectDatasetFiles</a>(pFromRaw, <a class="code" href="shapes-main_8cpp.html#af47e33e3634a86d1d5c282fead075e24">file_formats</a>.at(<span class="stringliteral">&quot;text&quot;</span>));</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;f : files) <a class="code" href="beta_2shapes-main_8cpp.html#a6f75b75f2d0e71cf4186e65873f6fe55">myreadstack</a>.push_back(f);</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <span class="comment">// Create the reading thread pool. Start processing the input shapes.</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <a class="code" href="beta_2shapes-main_8cpp.html#a6285f7490b6dd81ce98e2527e0620413">construct_thread_pool</a>(Num_Threads);</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <span class="comment">// The loop used for writing shapes in the output database.</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;            decltype(<a class="code" href="beta_2shapes-main_8cpp.html#ac6ebd12a47facab27a62eb12318407e5">mywritestack</a>)::value_type cur;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;            {</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                <span class="comment">// Awkward object encapsulation. I want RAII, but I want to</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                <span class="comment">// explicitly free the lock before sleeping this thread.</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                std::unique_ptr&lt;std::lock_guard&lt;std::mutex&gt; &gt; lOutStack</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                    = make_unique&lt;std::lock_guard&lt;std::mutex&gt;&gt;(<a class="code" href="beta_2shapes-main_8cpp.html#ad770ae469f46c5e465bcf7d48d8fc461">mOutStack</a>);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="beta_2shapes-main_8cpp.html#a6f75b75f2d0e71cf4186e65873f6fe55">myreadstack</a>.empty() &amp;&amp; <a class="code" href="beta_2shapes-main_8cpp.html#ac6ebd12a47facab27a62eb12318407e5">mywritestack</a>.empty() &amp;&amp; !<a class="code" href="beta_2shapes-main_8cpp.html#a6e46e701431fdc40f70f68212577e809">countCurrentReading</a>.load()) {</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                    <span class="comment">// If there is nothing left to read or write, then we can exit the writer loop and</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                    <span class="comment">// end the program.</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                }</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="beta_2shapes-main_8cpp.html#ac6ebd12a47facab27a62eb12318407e5">mywritestack</a>.empty()) {</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                    <span class="comment">// There is nothing to write (waiting on readers to parse an input shape).</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                    <span class="comment">// Sleep for 100 milliseconds.</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                    lOutStack.reset();</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                    std::this_thread::sleep_for(std::chrono::milliseconds(100));</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                    <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                }</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                <span class="comment">// There is at least one object that is ready to be written to the output file.</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                <span class="comment">// Get this shape.</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                cur = <a class="code" href="beta_2shapes-main_8cpp.html#ac6ebd12a47facab27a62eb12318407e5">mywritestack</a>.front();</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                <a class="code" href="beta_2shapes-main_8cpp.html#ac6ebd12a47facab27a62eb12318407e5">mywritestack</a>.pop_front();</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;            }</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            {</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                <span class="comment">// Writing an output shape.</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                <span class="comment">// Trying to figure out where to put the shape in the database.</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                <span class="comment">// For this example, single file reads may occasionally occur,</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                <span class="comment">// and the groupName would just be &quot;/&quot;, which is not correct.</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                <span class="comment">// TODO: Make this clearer.</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                std::string groupName = std::get&lt;2&gt;(cur);</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                <span class="keywordflow">if</span> (groupName == <span class="stringliteral">&quot;/&quot;</span>) groupName = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                <span class="keyword">const</span> std::string particleId = std::get&lt;0&gt;(cur).required.particle_id;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                if (!groupName.size() &amp;&amp; particleId.size()) groupName = particleId;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                <span class="keywordflow">if</span> (!groupName.size()) groupName = <span class="stringliteral">&quot;shape&quot;</span>;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                <span class="comment">// Write the shape</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                <span class="keyword">auto</span> sgrp = basegrp-&gt;createGroup(groupName);</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                <span class="keyword">auto</span> shp = std::get&lt;0&gt;(cur).toShape(</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                    std::get&lt;1&gt;(cur).filename().string(), sgrp-&gt;getHDF5Group());</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;            }</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        }</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <span class="comment">// Ensure that all threads are completed, and re-join them with the main process.</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;t : <a class="code" href="beta_2shapes-main_8cpp.html#a960132aac36b2821e18a312a2b820b97">pool</a>) t-&gt;join(); <span class="comment">// These are all completed by the time this line is reached.</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    }</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="comment">// Ensure that unhandled errors are displayed before the application terminates.</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception &amp;e) {</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        std::cerr &lt;&lt; e.what() &lt;&lt; std::endl;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    }</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keywordflow">catch</span> (...) {</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        std::cerr &lt;&lt; <span class="stringliteral">&quot;Unknown exception caught.&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    }</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;}</div><div class="ttc" id="namespaceicedb_1_1fs_1_1impl_html_ae58335756c72cfc8f4f13eae099c969a"><div class="ttname"><a href="namespaceicedb_1_1fs_1_1impl.html#ae58335756c72cfc8f4f13eae099c969a">icedb::fs::impl::collectDatasetFiles</a></div><div class="ttdeci">CollectedFilesRet_Type collectDatasetFiles(const sfs::path &amp;base, const ExtensionsMatching_Type &amp;valid_extensions)</div><div class="ttdef"><b>Definition:</b> <a href="fs__backend_8cpp_source.html#l00026">fs_backend.cpp:26</a></div></div>
<div class="ttc" id="beta_2shapes-main_8cpp_html_a6f75b75f2d0e71cf4186e65873f6fe55"><div class="ttname"><a href="beta_2shapes-main_8cpp.html#a6f75b75f2d0e71cf4186e65873f6fe55">myreadstack</a></div><div class="ttdeci">std::deque&lt; std::pair&lt; sfs::path, std::string &gt; &gt; myreadstack</div><div class="ttdef"><b>Definition:</b> <a href="beta_2shapes-main_8cpp_source.html#l00065">shapes-main.cpp:65</a></div></div>
<div class="ttc" id="beta_2shapes-main_8cpp_html_a008512d236c3702c3fa30e760d958acd"><div class="ttname"><a href="beta_2shapes-main_8cpp.html#a008512d236c3702c3fa30e760d958acd">basegrp</a></div><div class="ttdeci">icedb::Groups::Group::Group_ptr basegrp</div><div class="ttdoc">Shapes get written to this location in the output database. </div><div class="ttdef"><b>Definition:</b> <a href="beta_2shapes-main_8cpp_source.html#l00079">shapes-main.cpp:79</a></div></div>
<div class="ttc" id="namespacestd_html"><div class="ttname"><a href="namespacestd.html">std</a></div><div class="ttdoc">STL namespace. </div></div>
<div class="ttc" id="beta_2shapes-main_8cpp_html_a6285f7490b6dd81ce98e2527e0620413"><div class="ttname"><a href="beta_2shapes-main_8cpp.html#a6285f7490b6dd81ce98e2527e0620413">construct_thread_pool</a></div><div class="ttdeci">bool construct_thread_pool(int numThreads)</div><div class="ttdoc">Convenience function to build a pool of threads for parsing shapes and writing to the hdf5 file...</div><div class="ttdef"><b>Definition:</b> <a href="beta_2shapes-main_8cpp_source.html#l00132">shapes-main.cpp:132</a></div></div>
<div class="ttc" id="shapes-main_8cpp_html_af47e33e3634a86d1d5c282fead075e24"><div class="ttname"><a href="shapes-main_8cpp.html#af47e33e3634a86d1d5c282fead075e24">file_formats</a></div><div class="ttdeci">const std::map&lt; std::string, std::set&lt; std::string &gt; &gt; file_formats</div><div class="ttdef"><b>Definition:</b> <a href="shapes-main_8cpp_source.html#l00017">shapes-main.cpp:17</a></div></div>
<div class="ttc" id="namespaceicedb_1_1fs_1_1hdf5_html_aa823e59a8819be3d124fc64700385fe7"><div class="ttname"><a href="namespaceicedb_1_1fs_1_1hdf5.html#aa823e59a8819be3d124fc64700385fe7">icedb::fs::hdf5::useZLIB</a></div><div class="ttdeci">int useZLIB()</div><div class="ttdef"><b>Definition:</b> <a href="export-hdf5_8cpp_source.html#l00017">export-hdf5.cpp:17</a></div></div>
<div class="ttc" id="beta_2shapes-main_8cpp_html_a33d07d20f02fedf81b5233e8669dc795"><div class="ttname"><a href="beta_2shapes-main_8cpp.html#a33d07d20f02fedf81b5233e8669dc795">resolution_um</a></div><div class="ttdeci">float resolution_um</div><div class="ttdoc">The resolution of each shape lattice, in micrometers. </div><div class="ttdef"><b>Definition:</b> <a href="beta_2shapes-main_8cpp_source.html#l00076">shapes-main.cpp:76</a></div></div>
<div class="ttc" id="classicedb_1_1Databases_1_1Database_html_a099ccc5bf7ba50a4c7425f531728e480"><div class="ttname"><a href="classicedb_1_1Databases_1_1Database.html#a099ccc5bf7ba50a4c7425f531728e480">icedb::Databases::Database::Database_ptr</a></div><div class="ttdeci">std::unique_ptr&lt; Database &gt; Database_ptr</div><div class="ttdef"><b>Definition:</b> <a href="Database_8hpp_source.html#l00020">Database.hpp:20</a></div></div>
<div class="ttc" id="beta_2shapes-main_8cpp_html_ac6ebd12a47facab27a62eb12318407e5"><div class="ttname"><a href="beta_2shapes-main_8cpp.html#ac6ebd12a47facab27a62eb12318407e5">mywritestack</a></div><div class="ttdeci">std::deque&lt; std::tuple&lt; icedb::Examples::Shapes::ShapeDataBasic, sfs::path, std::string &gt; &gt; mywritestack</div><div class="ttdef"><b>Definition:</b> <a href="beta_2shapes-main_8cpp_source.html#l00067">shapes-main.cpp:67</a></div></div>
<div class="ttc" id="beta_2shapes-main_8cpp_html_a960132aac36b2821e18a312a2b820b97"><div class="ttname"><a href="beta_2shapes-main_8cpp.html#a960132aac36b2821e18a312a2b820b97">pool</a></div><div class="ttdeci">std::vector&lt; std::unique_ptr&lt; std::thread &gt; &gt; pool</div><div class="ttdoc">3d_structures program - An example program to read and write shape files </div><div class="ttdef"><b>Definition:</b> <a href="beta_2shapes-main_8cpp_source.html#l00054">shapes-main.cpp:54</a></div></div>
<div class="ttc" id="beta_2shapes-main_8cpp_html_ad770ae469f46c5e465bcf7d48d8fc461"><div class="ttname"><a href="beta_2shapes-main_8cpp.html#ad770ae469f46c5e465bcf7d48d8fc461">mOutStack</a></div><div class="ttdeci">std::mutex mOutStack</div><div class="ttdef"><b>Definition:</b> <a href="beta_2shapes-main_8cpp_source.html#l00060">shapes-main.cpp:60</a></div></div>
<div class="ttc" id="namespaceicedb_html"><div class="ttname"><a href="namespaceicedb.html">icedb</a></div><div class="ttdef"><b>Definition:</b> <a href="Attributes_8cpp_source.html#l00008">Attributes.cpp:8</a></div></div>
<div class="ttc" id="beta_2shapes-main_8cpp_html_a6e46e701431fdc40f70f68212577e809"><div class="ttname"><a href="beta_2shapes-main_8cpp.html#a6e46e701431fdc40f70f68212577e809">countCurrentReading</a></div><div class="ttdeci">std::atomic&lt; int &gt; countCurrentReading</div><div class="ttdef"><b>Definition:</b> <a href="beta_2shapes-main_8cpp_source.html#l00056">shapes-main.cpp:56</a></div></div>
<div class="ttc" id="beta_2shapes-main_8cpp_html_af2462107fd88e4fae695c56c89d224dc"><div class="ttname"><a href="beta_2shapes-main_8cpp.html#af2462107fd88e4fae695c56c89d224dc">nccompat</a></div><div class="ttdeci">bool nccompat</div><div class="ttdoc">Are we forcing NetCDF-4 compatability. </div><div class="ttdef"><b>Definition:</b> <a href="beta_2shapes-main_8cpp_source.html#l00077">shapes-main.cpp:77</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="beta_2shapes-main_8cpp_a3c04138a5bfe5d72780bb7e82a18e627_cgraph.png" border="0" usemap="#beta_2shapes-main_8cpp_a3c04138a5bfe5d72780bb7e82a18e627_cgraph" alt=""/></div>
<map name="beta_2shapes-main_8cpp_a3c04138a5bfe5d72780bb7e82a18e627_cgraph" id="beta_2shapes-main_8cpp_a3c04138a5bfe5d72780bb7e82a18e627_cgraph">
<area shape="rect" id="node2" href="namespaceicedb_1_1fs_1_1impl.html#ae58335756c72cfc8f4f13eae099c969a" title="icedb::fs::impl::collect\lDatasetFiles" alt="" coords="110,60,261,101"/>
<area shape="rect" id="node5" href="beta_2shapes-main_8cpp.html#a6285f7490b6dd81ce98e2527e0620413" title="Convenience function to build a pool of threads for parsing shapes and writing to the hdf5 file..." alt="" coords="110,126,261,153"/>
<area shape="rect" id="node15" href="namespaceicedb_1_1fs_1_1hdf5.html#aa823e59a8819be3d124fc64700385fe7" title="icedb::fs::hdf5::useZLIB" alt="" coords="104,177,267,203"/>
<area shape="rect" id="node3" href="namespaceicedb_1_1fs_1_1impl.html#af0cc17c58406b9ca481838b4cd1bbfa7" title="Like resolveSymLinks, but throw if the resulting path does not exist. " alt="" coords="315,5,501,47"/>
<area shape="rect" id="node4" href="namespaceicedb_1_1fs_1_1impl.html#ae5c49e76db60602cedd6dd8317bceec1" title="Finds out where a symbolic link points to. " alt="" coords="557,32,712,73"/>
<area shape="rect" id="node6" href="beta_2shapes-main_8cpp.html#ae40c007b788d66f509cf4110d9c98e2a" title="This is the primary function in each thread devoted to reading shapes. Usually, about three of these ..." alt="" coords="372,126,444,153"/>
<area shape="rect" id="node7" href="namespaceicedb_1_1Examples_1_1Shapes.html#a7bc9f6fc2a9e7cab2a01c3ef5af40106" title="icedb::Examples::Shapes\l::readTextFile" alt="" coords="549,119,720,160"/>
<area shape="rect" id="node8" href="namespaceicedb_1_1Examples_1_1Shapes.html#af4f846f5268e26fe554768d8e0844f0d" title="icedb::Examples::Shapes\l::readDDSCAT" alt="" coords="768,85,939,127"/>
<area shape="rect" id="node14" href="namespaceicedb_1_1Examples_1_1Shapes.html#ab50b849f9533e0dcccd4eb57e19310f0" title="Simple file assuming one substance, with 3&#45;column rows, each representing a single point..." alt="" coords="768,151,939,192"/>
<area shape="rect" id="node9" href="namespaceicedb_1_1Examples_1_1Shapes.html#aa83815532aea205d67b56220bc965228" title="icedb::Examples::Shapes\l::readHeader" alt="" coords="987,27,1157,68"/>
<area shape="rect" id="node10" href="namespaceicedb_1_1Examples_1_1Shapes.html#a8e0f657be09aae9687aa63bed84f46a1" title="icedb::Examples::Shapes\l::readTextContents" alt="" coords="987,92,1157,133"/>
<area shape="rect" id="node11" href="namespaceanonymous__namespace_02shapeIOtextParsers_8cpp_03.html#a705c1ebc6b7a4f400cb8d225dfd2d26b" title="Parses space&#45;separated shapefile entries. " alt="" coords="1205,107,1368,177"/>
<area shape="rect" id="node12" href="namespaceanonymous__namespace_02shapeIOtextParsers_8cpp_03.html#a9119256a03fa440b5b7102800d756198" title="Used in quickly printing shapefile. " alt="" coords="1421,63,1583,133"/>
<area shape="rect" id="node13" href="namespaceanonymous__namespace_02shapeIOtextParsers_8cpp_03.html#a3590d9b16b4a098b6ddbcec4819f4c52" title="anonymous_namespace\l\{shapeIOtextParsers\l::cpp\}::print_shapefile_pts" alt="" coords="1416,158,1588,214"/>
</map>
</div>

</div>
</div>
<a id="ae40c007b788d66f509cf4110d9c98e2a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae40c007b788d66f509cf4110d9c98e2a">&#9670;&nbsp;</a></span>readtask()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void readtask </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This is the primary function in each thread devoted to reading shapes. Usually, about three of these threads are active. </p>
<p>This is a simple loop.</p><ol type="1">
<li>Read from "myreadstack" to get the filename of an input shape.</li>
<li>Read the shape.</li>
<li>Put the read shape on "mywritestack".</li>
<li>Read another shape. If the reading stack (myreadstack) is empty, then stop this thread. </li>
</ol>

<p class="definition">Definition at line <a class="el" href="beta_2shapes-main_8cpp_source.html#l00090">90</a> of file <a class="el" href="beta_2shapes-main_8cpp_source.html">shapes-main.cpp</a>.</p>

<p class="reference">References <a class="el" href="beta_2shapes-main_8cpp_source.html#l00056">countCurrentReading</a>, <a class="el" href="beta_2shapes-main_8cpp_source.html#l00060">mOutStack</a>, <a class="el" href="beta_2shapes-main_8cpp_source.html#l00060">mStack</a>, <a class="el" href="beta_2shapes-main_8cpp_source.html#l00077">nccompat</a>, <a class="el" href="apps_23d__structures_2shape_8hpp_source.html#l00020">icedb::Examples::Shapes::ShapeRequiredData::particle_id</a>, <a class="el" href="shapeIOtextParsers_8cpp_source.html#l00343">icedb::Examples::Shapes::readTextFile()</a>, <a class="el" href="apps_23d__structures_2shape_8hpp_source.html#l00033">icedb::Examples::Shapes::ShapeDataBasic::required</a>, and <a class="el" href="beta_2shapes-main_8cpp_source.html#l00076">resolution_um</a>.</p>

<p class="reference">Referenced by <a class="el" href="beta_2shapes-main_8cpp_source.html#l00132">construct_thread_pool()</a>.</p>
<div class="fragment"><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                {</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="comment">// Loop constantly, pulling new shape locations from the stack.</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="comment">// If we run out of shapes to read, then the thread terminates.</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="comment">// We protect against premature termination using mutex locks - </span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="comment">// the main program locks the reading stack until it is populated.</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        decltype(<a class="code" href="beta_2shapes-main_8cpp.html#a6f75b75f2d0e71cf4186e65873f6fe55">myreadstack</a>)::value_type cur; <span class="comment">// The current object being read by this thread.</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        {</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;            <span class="comment">// Each thread in the reading stack locks mStack to have exclusive access to &quot;myreadstack&quot;.</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;            <span class="comment">// It pops off an element from the reading stack and processes it.</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            std::lock_guard&lt;std::mutex&gt; lStack(<a class="code" href="beta_2shapes-main_8cpp.html#afffb20412201640ed4485ef8f3e87777">mStack</a>);</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="beta_2shapes-main_8cpp.html#a6f75b75f2d0e71cf4186e65873f6fe55">myreadstack</a>.empty()) <span class="keywordflow">return</span>;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            cur = <a class="code" href="beta_2shapes-main_8cpp.html#a6f75b75f2d0e71cf4186e65873f6fe55">myreadstack</a>.front();</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;            <a class="code" href="beta_2shapes-main_8cpp.html#a6e46e701431fdc40f70f68212577e809">countCurrentReading</a>++; <span class="comment">// Keep track of the number of active reads, to prevent premature program termination.</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;            <a class="code" href="beta_2shapes-main_8cpp.html#a6f75b75f2d0e71cf4186e65873f6fe55">myreadstack</a>.pop_front();</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;            <span class="comment">// Once we are done with manipulating &quot;myreadstack&quot;, then the mutex lock is released and</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            <span class="comment">// another thread can use it.</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        }</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        <span class="comment">// Read the text file.</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <span class="keyword">auto</span> data = <a class="code" href="namespaceicedb_1_1Examples_1_1Shapes.html#a7bc9f6fc2a9e7cab2a01c3ef5af40106">icedb::Examples::Shapes::readTextFile</a>(cur.first.string());</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <span class="comment">// Set a basic particle id. This id is used when writing the shape to the output file.</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <span class="comment">// In this example, objects in the output file are named according to their ids.</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        data.<a class="code" href="structicedb_1_1Examples_1_1Shapes_1_1ShapeDataBasic.html#adff60c1ae04961a158d47a05061ef21b">required</a>.<a class="code" href="structicedb_1_1Examples_1_1Shapes_1_1ShapeRequiredData.html#a3e9178c25d1b4ecda9b69f0ea7a1ce7c">particle_id</a> = cur.first.filename().string();</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        data.required.NC4_compat = <a class="code" href="beta_2shapes-main_8cpp.html#af2462107fd88e4fae695c56c89d224dc">nccompat</a>;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="beta_2shapes-main_8cpp.html#a33d07d20f02fedf81b5233e8669dc795">resolution_um</a>)</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;            data.optional.particle_scattering_element_spacing = <a class="code" href="beta_2shapes-main_8cpp.html#a33d07d20f02fedf81b5233e8669dc795">resolution_um</a> / 1.e6f;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        {</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;            <span class="comment">// We enter a new scope to lock the output stack (mOutStack / mywritestack).</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            <span class="comment">// We lock the output stack because we are appending to it.</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;            std::lock_guard&lt;std::mutex&gt; lOutStack(<a class="code" href="beta_2shapes-main_8cpp.html#ad770ae469f46c5e465bcf7d48d8fc461">mOutStack</a>);</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;            <span class="comment">//std::cout &lt;&lt; &quot;.&quot; &lt;&lt; std::endl;</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;            <a class="code" href="beta_2shapes-main_8cpp.html#ac6ebd12a47facab27a62eb12318407e5">mywritestack</a>.push_back(</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                std::tuple&lt;icedb::Examples::Shapes::ShapeDataBasic, sfs::path, std::string&gt;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                (std::move(data), cur.first, cur.second));</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;            <a class="code" href="beta_2shapes-main_8cpp.html#a6e46e701431fdc40f70f68212577e809">countCurrentReading</a>--;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        }</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    }</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;}</div><div class="ttc" id="beta_2shapes-main_8cpp_html_afffb20412201640ed4485ef8f3e87777"><div class="ttname"><a href="beta_2shapes-main_8cpp.html#afffb20412201640ed4485ef8f3e87777">mStack</a></div><div class="ttdeci">std::mutex mStack</div><div class="ttdef"><b>Definition:</b> <a href="beta_2shapes-main_8cpp_source.html#l00060">shapes-main.cpp:60</a></div></div>
<div class="ttc" id="beta_2shapes-main_8cpp_html_a6f75b75f2d0e71cf4186e65873f6fe55"><div class="ttname"><a href="beta_2shapes-main_8cpp.html#a6f75b75f2d0e71cf4186e65873f6fe55">myreadstack</a></div><div class="ttdeci">std::deque&lt; std::pair&lt; sfs::path, std::string &gt; &gt; myreadstack</div><div class="ttdef"><b>Definition:</b> <a href="beta_2shapes-main_8cpp_source.html#l00065">shapes-main.cpp:65</a></div></div>
<div class="ttc" id="namespaceicedb_1_1Examples_1_1Shapes_html_a7bc9f6fc2a9e7cab2a01c3ef5af40106"><div class="ttname"><a href="namespaceicedb_1_1Examples_1_1Shapes.html#a7bc9f6fc2a9e7cab2a01c3ef5af40106">icedb::Examples::Shapes::readTextFile</a></div><div class="ttdeci">ShapeDataBasic readTextFile(const std::string &amp;filename)</div><div class="ttdef"><b>Definition:</b> <a href="shapeIOtextParsers_8cpp_source.html#l00343">shapeIOtextParsers.cpp:343</a></div></div>
<div class="ttc" id="beta_2shapes-main_8cpp_html_a33d07d20f02fedf81b5233e8669dc795"><div class="ttname"><a href="beta_2shapes-main_8cpp.html#a33d07d20f02fedf81b5233e8669dc795">resolution_um</a></div><div class="ttdeci">float resolution_um</div><div class="ttdoc">The resolution of each shape lattice, in micrometers. </div><div class="ttdef"><b>Definition:</b> <a href="beta_2shapes-main_8cpp_source.html#l00076">shapes-main.cpp:76</a></div></div>
<div class="ttc" id="beta_2shapes-main_8cpp_html_ac6ebd12a47facab27a62eb12318407e5"><div class="ttname"><a href="beta_2shapes-main_8cpp.html#ac6ebd12a47facab27a62eb12318407e5">mywritestack</a></div><div class="ttdeci">std::deque&lt; std::tuple&lt; icedb::Examples::Shapes::ShapeDataBasic, sfs::path, std::string &gt; &gt; mywritestack</div><div class="ttdef"><b>Definition:</b> <a href="beta_2shapes-main_8cpp_source.html#l00067">shapes-main.cpp:67</a></div></div>
<div class="ttc" id="structicedb_1_1Examples_1_1Shapes_1_1ShapeRequiredData_html_a3e9178c25d1b4ecda9b69f0ea7a1ce7c"><div class="ttname"><a href="structicedb_1_1Examples_1_1Shapes_1_1ShapeRequiredData.html#a3e9178c25d1b4ecda9b69f0ea7a1ce7c">icedb::Examples::Shapes::ShapeRequiredData::particle_id</a></div><div class="ttdeci">std::string particle_id</div><div class="ttdef"><b>Definition:</b> <a href="apps_23d__structures_2shape_8hpp_source.html#l00020">shape.hpp:20</a></div></div>
<div class="ttc" id="beta_2shapes-main_8cpp_html_ad770ae469f46c5e465bcf7d48d8fc461"><div class="ttname"><a href="beta_2shapes-main_8cpp.html#ad770ae469f46c5e465bcf7d48d8fc461">mOutStack</a></div><div class="ttdeci">std::mutex mOutStack</div><div class="ttdef"><b>Definition:</b> <a href="beta_2shapes-main_8cpp_source.html#l00060">shapes-main.cpp:60</a></div></div>
<div class="ttc" id="beta_2shapes-main_8cpp_html_a6e46e701431fdc40f70f68212577e809"><div class="ttname"><a href="beta_2shapes-main_8cpp.html#a6e46e701431fdc40f70f68212577e809">countCurrentReading</a></div><div class="ttdeci">std::atomic&lt; int &gt; countCurrentReading</div><div class="ttdef"><b>Definition:</b> <a href="beta_2shapes-main_8cpp_source.html#l00056">shapes-main.cpp:56</a></div></div>
<div class="ttc" id="structicedb_1_1Examples_1_1Shapes_1_1ShapeDataBasic_html_adff60c1ae04961a158d47a05061ef21b"><div class="ttname"><a href="structicedb_1_1Examples_1_1Shapes_1_1ShapeDataBasic.html#adff60c1ae04961a158d47a05061ef21b">icedb::Examples::Shapes::ShapeDataBasic::required</a></div><div class="ttdeci">ShapeRequiredData required</div><div class="ttdef"><b>Definition:</b> <a href="apps_23d__structures_2shape_8hpp_source.html#l00033">shape.hpp:33</a></div></div>
<div class="ttc" id="beta_2shapes-main_8cpp_html_af2462107fd88e4fae695c56c89d224dc"><div class="ttname"><a href="beta_2shapes-main_8cpp.html#af2462107fd88e4fae695c56c89d224dc">nccompat</a></div><div class="ttdeci">bool nccompat</div><div class="ttdoc">Are we forcing NetCDF-4 compatability. </div><div class="ttdef"><b>Definition:</b> <a href="beta_2shapes-main_8cpp_source.html#l00077">shapes-main.cpp:77</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="beta_2shapes-main_8cpp_ae40c007b788d66f509cf4110d9c98e2a_cgraph.png" border="0" usemap="#beta_2shapes-main_8cpp_ae40c007b788d66f509cf4110d9c98e2a_cgraph" alt=""/></div>
<map name="beta_2shapes-main_8cpp_ae40c007b788d66f509cf4110d9c98e2a_cgraph" id="beta_2shapes-main_8cpp_ae40c007b788d66f509cf4110d9c98e2a_cgraph">
<area shape="rect" id="node2" href="namespaceicedb_1_1Examples_1_1Shapes.html#a7bc9f6fc2a9e7cab2a01c3ef5af40106" title="icedb::Examples::Shapes\l::readTextFile" alt="" coords="125,97,296,139"/>
<area shape="rect" id="node3" href="namespaceicedb_1_1Examples_1_1Shapes.html#af4f846f5268e26fe554768d8e0844f0d" title="icedb::Examples::Shapes\l::readDDSCAT" alt="" coords="344,64,515,105"/>
<area shape="rect" id="node9" href="namespaceicedb_1_1Examples_1_1Shapes.html#ab50b849f9533e0dcccd4eb57e19310f0" title="Simple file assuming one substance, with 3&#45;column rows, each representing a single point..." alt="" coords="344,129,515,171"/>
<area shape="rect" id="node4" href="namespaceicedb_1_1Examples_1_1Shapes.html#aa83815532aea205d67b56220bc965228" title="icedb::Examples::Shapes\l::readHeader" alt="" coords="563,5,733,47"/>
<area shape="rect" id="node5" href="namespaceicedb_1_1Examples_1_1Shapes.html#a8e0f657be09aae9687aa63bed84f46a1" title="icedb::Examples::Shapes\l::readTextContents" alt="" coords="563,71,733,112"/>
<area shape="rect" id="node6" href="namespaceanonymous__namespace_02shapeIOtextParsers_8cpp_03.html#a705c1ebc6b7a4f400cb8d225dfd2d26b" title="Parses space&#45;separated shapefile entries. " alt="" coords="781,85,944,156"/>
<area shape="rect" id="node7" href="namespaceanonymous__namespace_02shapeIOtextParsers_8cpp_03.html#a9119256a03fa440b5b7102800d756198" title="Used in quickly printing shapefile. " alt="" coords="997,41,1159,112"/>
<area shape="rect" id="node8" href="namespaceanonymous__namespace_02shapeIOtextParsers_8cpp_03.html#a3590d9b16b4a098b6ddbcec4819f4c52" title="anonymous_namespace\l\{shapeIOtextParsers\l::cpp\}::print_shapefile_pts" alt="" coords="992,137,1164,193"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="beta_2shapes-main_8cpp_ae40c007b788d66f509cf4110d9c98e2a_icgraph.png" border="0" usemap="#beta_2shapes-main_8cpp_ae40c007b788d66f509cf4110d9c98e2a_icgraph" alt=""/></div>
<map name="beta_2shapes-main_8cpp_ae40c007b788d66f509cf4110d9c98e2a_icgraph" id="beta_2shapes-main_8cpp_ae40c007b788d66f509cf4110d9c98e2a_icgraph">
<area shape="rect" id="node2" href="beta_2shapes-main_8cpp.html#a6285f7490b6dd81ce98e2527e0620413" title="Convenience function to build a pool of threads for parsing shapes and writing to the hdf5 file..." alt="" coords="125,5,276,32"/>
<area shape="rect" id="node3" href="beta_2shapes-main_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627" title="The main body of the program. " alt="" coords="324,5,375,32"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a008512d236c3702c3fa30e760d958acd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a008512d236c3702c3fa30e760d958acd">&#9670;&nbsp;</a></span>basegrp</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classicedb_1_1Groups_1_1Group.html#a8fab827d9a758f3ee76502f02901b9c2">icedb::Groups::Group::Group_ptr</a> basegrp</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Shapes get written to this location in the output database. </p>

<p class="definition">Definition at line <a class="el" href="beta_2shapes-main_8cpp_source.html#l00079">79</a> of file <a class="el" href="beta_2shapes-main_8cpp_source.html">shapes-main.cpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="beta_2shapes-main_8cpp_source.html#l00149">main()</a>, and <a class="el" href="databases_8cpp_source.html#l00034">icedb::Databases::Database_impl::makeDatabaseFileStandard()</a>.</p>

</div>
</div>
<a id="a6e46e701431fdc40f70f68212577e809"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6e46e701431fdc40f70f68212577e809">&#9670;&nbsp;</a></span>countCurrentReading</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::atomic&lt;int&gt; countCurrentReading</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="beta_2shapes-main_8cpp_source.html#l00056">56</a> of file <a class="el" href="beta_2shapes-main_8cpp_source.html">shapes-main.cpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="beta_2shapes-main_8cpp_source.html#l00149">main()</a>, and <a class="el" href="beta_2shapes-main_8cpp_source.html#l00090">readtask()</a>.</p>

</div>
</div>
<a id="a6ff39e8837d08d3882dff11186175cb5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6ff39e8837d08d3882dff11186175cb5">&#9670;&nbsp;</a></span>file_formats</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const std::map&lt;std::string, std::set&lt;sfs::path&gt; &gt; file_formats</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div><div class="line">    {<span class="stringliteral">&quot;text&quot;</span>, {<span class="stringliteral">&quot;.dat&quot;</span>, <span class="stringliteral">&quot;.shp&quot;</span>, <span class="stringliteral">&quot;.txt&quot;</span>, <span class="stringliteral">&quot;.shape&quot;</span>} },</div><div class="line">    {<span class="stringliteral">&quot;icedb&quot;</span>, {<span class="stringliteral">&quot;.hdf5&quot;</span>, <span class="stringliteral">&quot;.nc&quot;</span>, <span class="stringliteral">&quot;.h5&quot;</span>, <span class="stringliteral">&quot;.cdf&quot;</span>, <span class="stringliteral">&quot;.hdf&quot;</span>} }</div><div class="line">}</div></div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="beta_2shapes-main_8cpp_source.html#l00070">70</a> of file <a class="el" href="beta_2shapes-main_8cpp_source.html">shapes-main.cpp</a>.</p>

</div>
</div>
<a id="ad770ae469f46c5e465bcf7d48d8fc461"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad770ae469f46c5e465bcf7d48d8fc461">&#9670;&nbsp;</a></span>mOutStack</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::mutex mOutStack</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="beta_2shapes-main_8cpp_source.html#l00060">60</a> of file <a class="el" href="beta_2shapes-main_8cpp_source.html">shapes-main.cpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="beta_2shapes-main_8cpp_source.html#l00149">main()</a>, and <a class="el" href="beta_2shapes-main_8cpp_source.html#l00090">readtask()</a>.</p>

</div>
</div>
<a id="afffb20412201640ed4485ef8f3e87777"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afffb20412201640ed4485ef8f3e87777">&#9670;&nbsp;</a></span>mStack</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::mutex mStack</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="beta_2shapes-main_8cpp_source.html#l00060">60</a> of file <a class="el" href="beta_2shapes-main_8cpp_source.html">shapes-main.cpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="beta_2shapes-main_8cpp_source.html#l00090">readtask()</a>.</p>

</div>
</div>
<a id="a6f75b75f2d0e71cf4186e65873f6fe55"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f75b75f2d0e71cf4186e65873f6fe55">&#9670;&nbsp;</a></span>myreadstack</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::deque&lt;std::pair&lt;sfs::path, std::string&gt; &gt; myreadstack</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="beta_2shapes-main_8cpp_source.html#l00065">65</a> of file <a class="el" href="beta_2shapes-main_8cpp_source.html">shapes-main.cpp</a>.</p>

</div>
</div>
<a id="ac6ebd12a47facab27a62eb12318407e5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac6ebd12a47facab27a62eb12318407e5">&#9670;&nbsp;</a></span>mywritestack</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::deque&lt;std::tuple&lt;<a class="el" href="structicedb_1_1Examples_1_1Shapes_1_1ShapeDataBasic.html">icedb::Examples::Shapes::ShapeDataBasic</a>, sfs::path, std::string&gt; &gt; mywritestack</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="beta_2shapes-main_8cpp_source.html#l00067">67</a> of file <a class="el" href="beta_2shapes-main_8cpp_source.html">shapes-main.cpp</a>.</p>

</div>
</div>
<a id="af2462107fd88e4fae695c56c89d224dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af2462107fd88e4fae695c56c89d224dc">&#9670;&nbsp;</a></span>nccompat</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool nccompat = true</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Are we forcing NetCDF-4 compatability. </p>

<p class="definition">Definition at line <a class="el" href="beta_2shapes-main_8cpp_source.html#l00077">77</a> of file <a class="el" href="beta_2shapes-main_8cpp_source.html">shapes-main.cpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="beta_2shapes-main_8cpp_source.html#l00149">main()</a>, and <a class="el" href="beta_2shapes-main_8cpp_source.html#l00090">readtask()</a>.</p>

</div>
</div>
<a id="a960132aac36b2821e18a312a2b820b97"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a960132aac36b2821e18a312a2b820b97">&#9670;&nbsp;</a></span>pool</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;std::unique_ptr&lt;std::thread&gt; &gt; pool</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>3d_structures program - An example program to read and write shape files </p>
<p>This program reads shape files (in ADDA or DDSCAT formats) and writes an HDF5/netCDF file as an output. The program demonstrates how to create shapes using the library's C++ interface.</p>
<p>This example is multi-threaded. This makes it somewhat complicated. Read operations on ASCII text are slow, as are filesystem calls. This program can read in files at near disk speed. Sadly, HDF5 can only write objects using one thread at a time, and its internal compression filters are also single-threaded.</p>
<p>Here's how the program works:</p><ol type="1">
<li>Read the user options.</li>
<li>Collect a list of all valid shape files for input. Save this list to "myreadstack".</li>
<li>Spawn a pool of threads. Each thread in the pool will be dedicated to reading text-based shape files. 3a. Each reading thread gets the name of another shape file from "myreadstack", reads it, and stores the shape data on "mywritestack". 3b. The main thread (not in the pool) handles shape writing. It runs in a loop, waiting for shapes to populate "mywritestack". It checks every 100 milliseconds. It writes shapes sequentially to the output file.</li>
<li>Once there are no shapes to be read or written, execution terminates. </li>
</ol>

<p class="definition">Definition at line <a class="el" href="beta_2shapes-main_8cpp_source.html#l00054">54</a> of file <a class="el" href="beta_2shapes-main_8cpp_source.html">shapes-main.cpp</a>.</p>

</div>
</div>
<a id="a33d07d20f02fedf81b5233e8669dc795"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a33d07d20f02fedf81b5233e8669dc795">&#9670;&nbsp;</a></span>resolution_um</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float resolution_um = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The resolution of each shape lattice, in micrometers. </p>

<p class="definition">Definition at line <a class="el" href="beta_2shapes-main_8cpp_source.html#l00076">76</a> of file <a class="el" href="beta_2shapes-main_8cpp_source.html">shapes-main.cpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="beta_2shapes-main_8cpp_source.html#l00149">main()</a>, and <a class="el" href="beta_2shapes-main_8cpp_source.html#l00090">readtask()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
